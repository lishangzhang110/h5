(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pack_devices-pages-device-blueList"],{"0329":function(e,t,i){"use strict";var n=i("fb62"),a=i.n(n);a.a},"0465":function(e,t,i){"use strict";i.r(t);var n=i("c690"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},"05b1":function(e,t,i){var n=i("c86c");t=n(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * uni-app内置的常用样式变量\r\n */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */uni-page-body[data-v-9bf19064]{background-color:#f8f8f8}body.?%PAGE?%[data-v-9bf19064]{background-color:#f8f8f8}.container[data-v-9bf19064]{padding:0 %?30?% 0 %?30?%;align-items:center;background:#f3f4f7}.list-item[data-v-9bf19064]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;width:100%;padding:10px;box-sizing:border-box;background:#fff;border-radius:%?16?%;margin-top:%?20?%}.list-item .facility_img[data-v-9bf19064]{width:%?98?%;height:%?98?%;margin-right:%?20?%}.list-item .facility_msg[data-v-9bf19064]{display:flex;flex-direction:column;width:0;flex:1}.list-item[data-v-9bf19064]:last-child{border-style:none}.button[data-v-9bf19064]{position:fixed;width:%?690?%;bottom:%?30?%;background:#3ecebf!important}',""]),e.exports=t},9851:function(e,t,i){"use strict";i.r(t);var n=i("d0c3"),a=i("0465");for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);i("0329");var s=i("828b"),c=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,"9bf19064",null,!1,n["a"],void 0);t["default"]=c.exports},c690:function(e,t,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(i("2634")),o=n(i("2fdc"));i("aa9c"),i("8f71"),i("bf0f"),i("5ef2"),i("dc8a");var s=getApp(),c={data:function(){return{searching:!1,devicesList:[],list_height:"400"}},components:{},props:{},onLoad:function(e){var t=this;console.log(s.globalData);var i=(s.globalData.SystemInfo.windowHeight-50)*(750/s.globalData.SystemInfo.windowWidth)-120;t.list_height=i,uni.onBluetoothAdapterStateChange((function(e){t.searching=e.discovering,e.available||(t.searching=!1)})),uni.onBluetoothDeviceFound((function(e){var i=!0;console.log("发现设备",e);var n=["BP","JYK01","DYNA","PHYLIGHT","T1","SMARTBOX","MEDICINEB","KINFITT1","AILINK","YODA0"];if(e.deviceId){e.advertisData?e.advertisData=s.globalData.buf2hex(e.advertisData):e.advertisData="",console.log(e);for(var a=0;a<t.devicesList.length;a++)e.deviceId==t.devicesList[a].deviceId&&(i=!1);i&&t.devicesList.push(e)}else if(e.devices){var o=e.devices.filter((function(e){return n.some((function(t){return 0===e.name.toUpperCase().indexOf(t)}))}));if(0===o.length)return;o[0].advertisData?o[0].advertisData=s.globalData.buf2hex(o.advertisData):o[0].advertisData="",console.log(o);for(a=0;a<t.devicesList.length;a++)o[0].deviceId===t.devicesList[a].deviceId&&(i=!1);i&&("YODA0"===o[0].name.toUpperCase()&&(o[0].localName="智能体重秤"),t.devicesList.push(o[0]))}else if(e[0]){e[0].advertisData?e[0].advertisData=s.globalData.buf2hex(e[0].advertisData):e[0].advertisData="",console.log(e[0]);for(a=0;a<devices_list.length;a++)e[0].deviceId==t.devicesList[a].deviceId&&(i=!1);i&&t.devicesList.push(e[0])}t.devicesList=t.devicesList}))},onReady:function(){},onShow:function(){},onHide:function(){var e=this;e.devicesList=[],this.searching&&uni.stopBluetoothDevicesDiscovery({success:function(t){console.log(t),e.searching=!1}})},methods:{openBluetoothAdapter:function(){var e=this;return new Promise((function(t,i){uni.openBluetoothAdapter({success:function(e){console.log(e),uni.getBluetoothAdapterState({success:function(e){console.log(e)}}),t()},fail:function(t){console.log(t),uni.$u.toast("请检查手机蓝牙是否打开"),e.searching=!1,i()}})}))},authorizeBluetooth:function(){return new Promise((function(e,t){var i="scope.bluetooth",n=function(){return new Promise((function(e,t){uni.getSetting({success:function(n){var a=n.authSetting||{},o=Object.keys(a);return-1!==o.indexOf(i)?a[i]?e():function e(){return new Promise((function(t,n){uni.showModal({content:'请在设置中开启"蓝牙"选项!',cancelText:"拒绝",confirmText:"去设置",success:function(a){return a.confirm?uni.openSetting({success:function(n){var a=n.authSetting||{};return a[i]?t():e()},fail:function(e){return console.log("openSetting",e),n({errMsg:"openSetting:fail system error",errno:-2})}}):n({errMsg:"authorize:fail auth deny",errno:103})}})}))}():t({errMsg:"authorize:fail auth canceled",errno:-3})},fail:function(e){return t({errMsg:"getSetting:fail system error",errno:-2})}})}))};uni.authorize({scope:i,success:function(t){e(t)},fail:function(e){n()}})}))},Search:function(){var e=this;return(0,o.default)((0,a.default)().mark((function t(){return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.searching){t.next=21;break}return uni.showLoading({title:"蓝牙初始化中..."}),t.prev=2,t.next=5,new Promise((function(e,t){uni.closeBluetoothAdapter({success:e,fail:e,complete:e})}));case 5:return uni.hideLoading(),t.next=8,e.openBluetoothAdapter();case 8:return uni.hideLoading(),uni.showToast({title:"蓝牙模块初始化成功"}),t.next=12,new Promise((function(t,i){uni.startBluetoothDevicesDiscovery({allowDuplicatesKey:!1,success:function(){e.searching=!0,e.devicesList=[],t()},fail:i})}));case 12:t.next=19;break;case 14:t.prev=14,t.t0=t["catch"](2),uni.hideLoading(),uni.showModal({content:"蓝牙模块初始化失败，请确认系统蓝牙及定位是否已打开"}),console.error("蓝牙初始化失败:",t.t0);case 19:t.next=22;break;case 21:uni.stopBluetoothDevicesDiscovery({success:function(){e.searching=!1}});case 22:case"end":return t.stop()}}),t,null,[[2,14]])})))()},Connect:function(e){var t=this;uni.showLoading({title:"正在连接设备..."});try{var i,n=this;console.log(e.currentTarget.id);for(var a=0;a<n.devicesList.length;a++)e.currentTarget.id==n.devicesList[a].deviceId&&(i=n.devicesList[a],n.devicesList[a].name,n.devicesList[a].advertisData);uni.stopBluetoothDevicesDiscovery({success:function(e){console.log(e),n.searching=!1}}),this.$store.dispatch("bindDevice",i).then((function(e){t.$store.dispatch("getBindDeviceList").then((function(){if("YODA0"===e.model)return uni.hideLoading(),void uni.navigateBack({delta:1});t.$store.dispatch("initializeDevice").then((function(){uni.hideLoading(),uni.navigateBack({delta:1})})).catch((function(){uni.hideLoading(),uni.showModal({title:"提示",content:"绑定设备失败，请重新绑定",showCancel:!1})}))})).catch((function(){uni.hideLoading(),uni.showModal({title:"提示",content:"绑定设备失败，请重新绑定",showCancel:!1})}))})).catch((function(e){uni.hideLoading(),uni.showModal({title:"提示",content:e.msg,showCancel:!1})}))}catch(o){console.log(o),uni.showModal({title:"提示",content:"连接设备失败，请重新连接",showCancel:!1})}}}};t.default=c},d0c3:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"container"},[i("v-uni-scroll-view",{style:"width:690rpx;height:"+e.list_height+"rpx",attrs:{"scroll-y":!0}},[e._l(e.devicesList,(function(t,n){return[i("v-uni-view",{key:n+"_0",staticClass:"list-item",attrs:{id:t.deviceId},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.Connect.apply(void 0,arguments)}}},[i("v-uni-image",{staticClass:"facility_img",attrs:{mode:"aspectFit",src:"https://app.hqhis.com/cdn/images/newui/mine/facility.png"}}),i("v-uni-view",{staticClass:"facility_msg"},[i("v-uni-text",{staticStyle:{"font-size":"medium","word-break":"break-all"}},[e._v("设备名称: "+e._s(t.localName))]),i("v-uni-text",{staticStyle:{"font-size":"x-small",color:"gray","word-break":"break-all"}},[e._v("设备ID: "+e._s(t.deviceId))]),i("v-uni-text",{staticStyle:{"font-size":"x-small",color:"gray","word-break":"break-all"}},[e._v("信号强度RSSI: "+e._s(t.RSSI))])],1),i("v-uni-image",{staticStyle:{width:"36px",height:"36px"},attrs:{mode:"aspectFit",src:"/static/images/bluetooth.png"}})],1)]}))],2),i("v-uni-button",{staticClass:"button",attrs:{type:"primary",loading:e.searching},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.Search.apply(void 0,arguments)}}},[e._v(e._s(e.searching?"搜索中...":"搜索蓝牙设备"))])],1)},a=[]},fb62:function(e,t,i){var n=i("05b1");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=i("967d").default;a("4d639e7b",n,!0,{sourceMap:!1,shadowMode:!1})}}]);