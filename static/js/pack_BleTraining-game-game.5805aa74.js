(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pack_BleTraining-game-game"],{"14ad":function(t,e,i){"use strict";i.r(e);var a=i("f788"),n=i("60a2");for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);i("37a5");var o=i("828b"),r=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,"6ff55686",null,!1,a["a"],void 0);e["default"]=r.exports},"37a5":function(t,e,i){"use strict";var a=i("bfa4"),n=i.n(a);n.a},"3ddb":function(t,e,i){var a=i("c86c");e=a(!1),e.push([t.i,".container[data-v-6ff55686]{width:100vw;height:100vh;position:relative;overflow:hidden}.bg-image[data-v-6ff55686]{position:absolute;width:100%;height:100%;z-index:1}.body[data-v-6ff55686]{position:relative;z-index:2;height:100%;display:flex;flex-direction:column}.main[data-v-6ff55686]{flex:1;display:flex;flex-direction:column;position:relative;overflow:hidden}\r\n\r\n/* 底部提示样式 */.bottom[data-v-6ff55686]{height:%?250?%}.operation-tips[data-v-6ff55686]{padding:%?30?%;opacity:1;background:#fff;border-radius:10px;background:linear-gradient(50deg,#e8f5ff -125%,#fff 142%);border:1px solid rgba(168,206,251,.5289);box-shadow:0 0 14px 0 rgba(79,79,79,.0641)}.tips-title[data-v-6ff55686]{font-size:%?32?%;margin-bottom:%?20?%}.tips-content[data-v-6ff55686]{color:#666;line-height:1.6}\r\n\r\n/* 游戏区域样式 */.game[data-v-6ff55686]{width:100%;height:100%;position:absolute;top:0;left:0;z-index:5}.game-bg[data-v-6ff55686]{position:absolute;width:100%;height:100%;z-index:1}.bird[data-v-6ff55686]{position:absolute;left:20%;width:40px;height:40px;z-index:10}.bird uni-image[data-v-6ff55686]{width:100%;height:100%;display:block}.pipe-pair[data-v-6ff55686]{position:absolute;top:0;width:20px;height:100%}.pipe[data-v-6ff55686]{position:absolute;width:100%;background:linear-gradient(180deg,#ff6b6b,#ff8787)}.pipe-top[data-v-6ff55686]{top:0;border-radius:10px}.pipe-bottom[data-v-6ff55686]{top:0;border-radius:10px}.difficulty-tip[data-v-6ff55686]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background:rgba(0,0,0,.7);color:#fff;padding:10px 20px;border-radius:20px;font-size:16px;opacity:0;transition:opacity .3s;z-index:100}.difficulty-tip.show[data-v-6ff55686]{opacity:1}.current-score[data-v-6ff55686]{position:absolute;top:20px;right:20px;background:rgba(0,0,0,.6);padding:8px 16px;border-radius:20px;z-index:10}.score-value[data-v-6ff55686]{color:#fff;font-size:20px;font-weight:700}\r\n\r\n/* 结果弹框样式开始 */.result-modal[data-v-6ff55686]{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:20}.result-modal .modal-content[data-v-6ff55686]{position:relative;width:90%;padding-top:%?420?%;top:%?0?%;text-align:center;border-radius:0 0 %?20?% %?20?%}.result-modal .modal-bg[data-v-6ff55686]{position:absolute;top:%?-100?%;left:0;width:100%;z-index:1}.result-modal .content-wrapper[data-v-6ff55686]{position:relative;z-index:1;top:%?-130?%}.result-modal .score[data-v-6ff55686]{font-size:20px;font-weight:700;color:#fff}.result-modal .score-text[data-v-6ff55686]{font-size:16px;color:#fff;margin-bottom:60px}.result-modal .stats[data-v-6ff55686]{display:flex;justify-content:center;align-items:center;margin:10px 0 40px}.result-modal .stat-item[data-v-6ff55686]{flex:1;text-align:center}.result-modal .divider[data-v-6ff55686]{width:1px;height:40px;background:#eee;margin:0 20px}.result-modal .stat-value[data-v-6ff55686]{font-size:24px;font-weight:700;color:#333}.result-modal .stat-label[data-v-6ff55686]{font-size:14px;color:#666;margin-top:5px}.result-modal .button-group[data-v-6ff55686]{display:flex;justify-content:space-between;padding:0 %?30?%;gap:15px}.result-modal .btn[data-v-6ff55686]{flex:1;line-height:%?96?%;font-size:%?32?%;text-align:center;height:%?96?%;border-radius:%?10?%;color:#fff;display:flex;align-items:center;justify-content:center}.result-modal .btn-retry[data-v-6ff55686]{background:linear-gradient(90deg,#59c2ff,#1b84ff);color:#fff}.result-modal .btn-confirm[data-v-6ff55686]{color:#1b84ff;border:1px solid #5d94ff}\r\n\r\n/* 结果弹框样式结束 */",""]),t.exports=e},"60a2":function(t,e,i){"use strict";i.r(e);var a=i("bfc6"),n=i.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e["default"]=n.a},"7b3f":function(t,e,i){"use strict";i("6a54");var a=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("9b8e")),s=n.default.observable({isBlueActive:!1,bluetoothDevices:{connected:null,deviceId:"",deviceType:"",serviceId:"",characteristicId:""},taskInfo:{taskId:null,exhale_duration:0}}),o={setBluetoothDevices:function(t){s.bluetoothDevices=t},setTaskInfo:function(t){s.taskInfo=t},setIsBlueActive:function(t){s.isBlueActive=t}},r={state:s,mutations:o};e.default=r},b5dd:function(t,e,i){"use strict";i("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.bleDataChange=function(t,e){var i=t.deviceId,s=t.serviceId,o=t.characteristicId;if(!(i&&i&&o))return n();uni.notifyBLECharacteristicValueChange({deviceId:i,serviceId:s,characteristicId:o,state:!0});uni.onBLECharacteristicValueChange((function(i){var n=function(t,e){var i=e.deviceType;return"JYK"==i?function(t){var e=a(t);if(20!==e.length)return{dataType:"init"==i,pressure:0,volume:0};var i=e.substring(0,2),n=e.substring(2,10),s=parseInt(n,16),o=e.substring(10,18),r=parseInt(o,16),l={dataType:81==i?"exhale":"inhale",pressure:s,volume:r};return console.log("解析结果:",l),l}(t):"FH"==i?function(t){var e=a(t);if(console.log("原始16进制数据:",e),20!==e.length)return{dataType:"init"==i,pressure:0,volume:0};var i=e.substring(0,2),n=e.substring(2,10),s=parseInt(n,16),o=e.substring(10,18),r=parseInt(o,16),l={dataType:81==i?"exhale":"inhale",pressure:s,volume:r};return console.log("解析结果:",l),l}(t):uni.showModal({title:"提示",content:"设备类型错误",showCancel:!1})}(i.value,t),s=n.dataType,o=n.pressure,r=n.volume;"exhale"!==s&&"inhale"!==s||e&&e(s,o,r)}))},e.bleDataStop=function(){uni.offBLECharacteristicValueChange(),uni.offBluetoothAdapterStateChange()},e.checkBluetooth=n,e.onBluetoothAdapterStateChange=function(){uni.onBluetoothAdapterStateChange((function(t){t.available||uni.showModal({title:"提示",content:"请打开蓝牙后重试",showCancel:!1})}))},i("fd3c"),i("4db2"),i("bf0f"),i("c976"),i("4d8f"),i("7b97"),i("668a"),i("c5b7"),i("8ff5"),i("2378"),i("641a"),i("64e0"),i("cce3"),i("efba"),i("d009"),i("bd7d"),i("7edd"),i("d798"),i("f547"),i("5e54"),i("b60a"),i("8c18"),i("12973"),i("f991"),i("198e"),i("8557"),i("63b1"),i("1954"),i("1cf1"),i("f7a5"),i("c9b5"),i("ab80"),i("e966");var a=function(t){var e=Array.prototype.map.call(new Uint8Array(t),(function(t){return("00"+t.toString(16)).slice(-2)}));return e.join("")};function n(){uni.openBluetoothAdapter().catch((function(t){var e=10001===t.errCode?"请打开蓝牙后重试":"初始化失败：".concat(t.errMsg);return uni.showModal({title:"提示",content:e,showCancel:!1}),Promise.reject(t)}))}},bfa4:function(t,e,i){var a=i("3ddb");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("967d").default;n("1a1be534",a,!0,{sourceMap:!1,shadowMode:!1})},bfc6:function(t,e,i){"use strict";i("6a54");var a=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("9b1b")),s=a(i("2634")),o=a(i("2fdc"));i("5c47"),i("fd3c"),i("8f71"),i("bf0f"),i("aa9c");var r=i("eb30"),l=a(i("7b3f")),u=i("b5dd"),d={data:function(){return{birdY:r.PHYSICS_CONSTANTS.INITIAL_BIRD_Y,velocity:0,pipes:[],showResult:!1,duration:0,bestScore:0,ranking:0,gameLevel:r.DIFFICULTY_CONSTANTS.LEVEL_1,gameStatus:r.GAME_STATUS.READY,pipeSpeed:r.GAME_CONSTANTS.INITIAL_PIPE_SPEED,gravity:r.PHYSICS_CONSTANTS.GRAVITY,liftForce:r.PHYSICS_CONSTANTS.LIFT_FORCE,pipeGap:r.GAME_CONSTANTS.INITIAL_PIPE_GAP,pipeWidth:r.GAME_CONSTANTS.INITIAL_PIPE_WIDTH,pipeDistance:r.GAME_CONSTANTS.INITIAL_PIPE_DISTANCE,mainHeight:0,showDifficultyTip:!1,difficultyTipText:"",grade:{status:"",msg:""}}},onLoad:function(){var t=this,e=uni.getStorageSync("flappyBirdBestScore")||0,i=uni.getWindowInfo();this.windowHeight=i.windowHeight,this.windowWidth=i.windowWidth;var a=uni.createSelectorQuery();a.select(".main").boundingClientRect((function(i){t.mainHeight=i.height,t.birdY=.6*i.height,t.bestScore=e,t.gameStatus=r.GAME_STATUS.READY})).exec()},onShow:function(){var t=this;return(0,o.default)((0,s.default)().mark((function e(){return(0,s.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:(0,u.bleDataChange)(l.default.state.bluetoothDevices,t.breathe);case 1:case"end":return e.stop()}}),e)})))()},onUnload:function(){this.blowTimeout&&clearTimeout(this.blowTimeout),this.animationTimer&&clearTimeout(this.animationTimer),this.timer&&clearInterval(this.timer),(0,u.bleDataStop)()},methods:{backHandler:function(){uni.navigateBack({delta:1})},breathe:function(t,e,i){var a=this,n=i>10;this.handleBlowAction(n),this.blowTimeout&&clearTimeout(this.blowTimeout),this.blowTimeout=setTimeout((function(){a.handleBlowAction(!1)}),200)},handleBlowAction:function(t){this.gameStatus===r.GAME_STATUS.READY&&t?this.startGame():this.gameStatus===r.GAME_STATUS.PLAYING&&(this.isPressed=t)},startGame:function(){var t=this;if(this.gameStatus===r.GAME_STATUS.READY){var e=this.generateInitialPipes();this.gameStatus=r.GAME_STATUS.PLAYING,this.velocity=r.GAME_CONSTANTS.BIRD_INITIAL_VELOCITY,this.pipes=e,this.duration=r.DIFFICULTY_CONSTANTS.INITIAL_DURATION,this.showResult=!1,this.pipeGap=r.GAME_CONSTANTS.INITIAL_PIPE_GAP,this.gameLevel=r.DIFFICULTY_CONSTANTS.LEVEL_0,this.showDifficultyTip=!1,this.difficultyTipText="",this.isPressed=!0,setTimeout((function(){t.isPressed=!1}),100),this.startTime=Date.now(),this.lastFrame=Date.now(),this.gameLoop(),this.timer=setInterval((function(){var e=Math.floor((Date.now()-t.startTime)/1e3);t.duration=e}),1e3)}},gameLoop:function(){var t=this;if(this.gameStatus===r.GAME_STATUS.PLAYING){var e,i=Date.now(),a=(i-this.lastFrame)/16;this.lastFrame=i,this.updateDifficulty(),e=this.isPressed?this.velocity+this.liftForce*a:this.velocity+this.gravity*a,e=Math.max(-8,Math.min(8,e));var s=Math.max(0,Math.min(this.mainHeight-40,this.birdY+e)),o=this.pipes.map((function(e){return(0,n.default)((0,n.default)({},e),{},{x:e.x-t.pipeSpeed*a})})),l=o.filter((function(e){return e.x>-t.pipeWidth})),u=l[l.length-1];(!u||u.x<this.windowWidth-this.pipeDistance)&&l.push(this.generatePipe(this.windowWidth)),this.birdY=s,this.velocity=e,this.pipes=l,this.checkCollision()||s<=0||s>=this.mainHeight-40?this.gameOver():this.animationTimer=setTimeout((function(){t.gameLoop()}),16)}},onTouchStart:function(){},onTouchEnd:function(){},generatePipe:function(t){var e=this.mainHeight,i=this.pipeGap,a=.4*e,n=Math.random()*(a-50)+50,s=e-n-i;return{x:t,topHeight:n,bottomTop:n+i,bottomHeight:s}},generateInitialPipes:function(){for(var t=[],e=0;e<3;e++)t.push(this.generatePipe(this.windowWidth+e*this.pipeDistance));return t},checkCollision:function(){var t=this,e=r.GAME_CONSTANTS.BIRD_SIZE,i=.2*this.windowWidth,a=i+e,n=this.birdY,s=n+e;return this.pipes.some((function(e){return!(e.x>a||i>e.x+t.pipeWidth)&&(n<e.topHeight||s>e.bottomTop)}))},calculateRanking:function(t){var e;return e=t<=20?Math.floor(20*Math.random()):t<=40?20+Math.floor(30*Math.random()):t<=80?50+Math.floor(30*Math.random()):t<=120?80+Math.floor(15*Math.random()):95+Math.floor(5*Math.random()),e},gameOver:function(){this.isPressed=!1,this.animationTimer&&clearTimeout(this.animationTimer),this.timer&&clearInterval(this.timer);var t=Math.floor((Date.now()-this.startTime)/1e3),e=Math.max(this.bestScore,t);uni.setStorageSync("flappyBirdBestScore",e);var i=this.calculateRanking(t);this.gameStatus=r.GAME_STATUS.OVER,this.showResult=!0,this.duration=t,this.bestScore=e,this.ranking=i,this.emitHandler()},restartGame:function(){this.timer&&clearInterval(this.timer),this.animationTimer&&clearTimeout(this.animationTimer),this.showResult=!1,this.gameStatus=r.GAME_STATUS.READY,this.duration=0,this.birdY=.6*this.mainHeight,this.velocity=0,this.pipes=[],this.gameLevel=r.DIFFICULTY_CONSTANTS.LEVEL_1,this.pipeGap=280,this.isPressed=!1},updateDifficulty:function(){var t=this,e=this.duration,i=this.pipeGap,a=this.gameLevel,n=this.pipeSpeed,s="";e>30&&this.gameLevel==r.DIFFICULTY_CONSTANTS.LEVEL_1?(i=250,a=r.DIFFICULTY_CONSTANTS.LEVEL_2,s="难度提升：中等"):e>60&&this.gameLevel==r.DIFFICULTY_CONSTANTS.LEVEL_2?(i=220,n=2.5,a=r.DIFFICULTY_CONSTANTS.LEVEL_3,s="难度提升：较难"):e>90&&this.gameLevel==r.DIFFICULTY_CONSTANTS.LEVEL_3?(i=180,n=3,a=r.DIFFICULTY_CONSTANTS.LEVEL_4,s="难度提升：困难"):e>120&&this.gameLevel==r.DIFFICULTY_CONSTANTS.LEVEL_4&&(i=100,n=4,a=r.DIFFICULTY_CONSTANTS.LEVEL_5,s="难度提升：超难"),this.gameLevel!==a&&(this.pipeGap=i,this.pipeSpeed=n,this.gameLevel=a,this.difficultyTipText=s,this.showDifficultyTip=!0,setTimeout((function(){t.showDifficultyTip=!1,t.difficultyTipText=""}),2e3))},emitHandler:function(){var t=l.default.state.taskInfo.exhale_duration;this.duration<t?this.grade={status:!1,msg:"打卡失败！未达到".concat(t,"秒")}:(this.grade={status:!0,msg:"打卡成功，成绩".concat(this.duration,"秒")},uni.$emit("ble-game-result",{duration:this.duration,ranking:this.ranking,bestScore:this.bestScore}))}}};e.default=d},c234:function(t,e,i){t.exports=i.p+"static/images/bird.png"},eb30:function(t,e,i){"use strict";i("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.PHYSICS_CONSTANTS=e.GAME_STATUS=e.GAME_CONSTANTS=e.DIFFICULTY_CONSTANTS=void 0;e.GAME_STATUS={READY:"ready",PLAYING:"playing",OVER:"over"};e.GAME_CONSTANTS={INITIAL_PIPE_GAP:280,INITIAL_PIPE_WIDTH:20,INITIAL_PIPE_DISTANCE:350,BIRD_SIZE:40,BIRD_INITIAL_VELOCITY:0,BIRD_MAX_VELOCITY:6,BIRD_MIN_VELOCITY:-1,INITIAL_PIPE_SPEED:2};e.PHYSICS_CONSTANTS={GRAVITY:.2,LIFT_FORCE:-.1,INITIAL_BIRD_Y:100};e.DIFFICULTY_CONSTANTS={LEVEL_1:1,LEVEL_2:2,LEVEL_3:3,LEVEL_4:4,LEVEL_5:5}},f788:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[a("v-uni-image",{staticClass:"bg-image",attrs:{src:"https://api.hqhis.com/admin-api/infra/file/4/get/9a9cd92703f25ab136ce161f2e2f9d5c9325e55f47c3380f266862fbbcef6d48.jpg",mode:"aspectFill"}}),a("v-uni-view",{staticClass:"body"},[a("v-uni-view",{staticClass:"main"},[a("v-uni-view",{staticClass:"current-score"},[a("v-uni-text",{staticClass:"score-value"},[t._v(t._s(t.duration)+"s")])],1),a("v-uni-view",{staticClass:"game",on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.onTouchStart.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.onTouchEnd.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"bird",style:"top: "+t.birdY+"px"},[a("v-uni-image",{attrs:{src:i("c234"),mode:"widthFix"}})],1),t._l(t.pipes,(function(t,e){return a("v-uni-view",{key:e,staticClass:"pipe-pair",style:"left: "+t.x+"px"},[a("v-uni-view",{staticClass:"pipe pipe-top",style:"height: "+t.topHeight+"px"}),a("v-uni-view",{staticClass:"pipe pipe-bottom",style:"top: "+t.bottomTop+"px; height: "+t.bottomHeight+"px"})],1)})),t.difficultyTipText?a("v-uni-view",{class:"difficulty-tip "+(t.showDifficultyTip?"show":"")},[t._v(" "+t._s(t.difficultyTipText)+" ")]):t._e()],2)],1),a("v-uni-view",{staticClass:"bottom margin"},[a("v-uni-view",{staticClass:"operation-tips"},[a("v-uni-view",{staticClass:"tips-title"},[t._v("游戏玩法")]),a("v-uni-view",{staticClass:"tips-content"},[t._v("对准测试仪吹气控制小鸟过障碍物，停止吹气小鸟降落 快来试试吧")])],1)],1)],1),t.showResult?a("v-uni-view",{staticClass:"result-modal"},[a("v-uni-view",{staticClass:"modal-content"},[a("v-uni-image",{staticClass:"modal-bg",attrs:{src:"https://api.hqhis.com/admin-api/infra/file/4/get/0458e89e92abf775f843988fb7e3d60056456db9507abe7d337da029e5a2e982.png",mode:"widthFix"}}),a("v-uni-view",{staticClass:"content-wrapper"},[a("v-uni-view",{staticClass:"score"},[t._v(t._s(t.grade.msg))]),a("v-uni-view",{staticClass:"stats"},[a("v-uni-view",{staticClass:"stat-item"},[a("v-uni-view",{staticClass:"stat-value"},[t._v(t._s(t.bestScore)+"s")]),a("v-uni-view",{staticClass:"stat-label"},[t._v("最高记录")])],1)],1),a("v-uni-view",{staticClass:"button-group"},[a("v-uni-button",{staticClass:"btn btn-retry",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.restartGame.apply(void 0,arguments)}}},[t._v("再试一次")]),a("v-uni-button",{staticClass:"btn btn-confirm",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.backHandler.apply(void 0,arguments)}}},[t._v("返回")])],1)],1)],1)],1):t._e()],1)},n=[]}}]);