(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pack_BleTraining-test-test"],{"1c23":function(t,e,a){var i=a("c86c");e=i(!1),e.push([t.i,'.container[data-v-43f85feb]{width:100vw;height:100vh;position:relative;overflow:hidden}.bg-image[data-v-43f85feb]{position:absolute;width:100%;height:100%;z-index:1}.body[data-v-43f85feb]{position:relative;z-index:2;height:100%;display:flex;flex-direction:column}.main[data-v-43f85feb]{flex:1;display:flex;flex-direction:column}.bottom[data-v-43f85feb]{height:%?200?%}.status-tip[data-v-43f85feb]{display:flex;justify-content:center;align-items:center;width:100%\r\n    /* margin: 50rpx 0 50rpx 0; */}.status-icon[data-v-43f85feb]{width:%?30?%;height:%?30?%;margin-right:%?10?%}.status-title[data-v-43f85feb]{font-size:%?34?%}.scale-container[data-v-43f85feb]{display:flex;height:%?800?%;margin:%?40?% %?250?%}.scale-numbers[data-v-43f85feb]{display:flex;flex-direction:column;justify-content:space-between;margin-right:%?20?%;color:#666}.scale-bar[data-v-43f85feb]{flex:1;position:relative;display:flex}.bar-gradient[data-v-43f85feb]{height:100%;width:%?50?%;display:flex;flex-direction:column}.gradient-section[data-v-43f85feb]{flex:1;width:100%}.divider[data-v-43f85feb]{height:%?2?%;width:100%;background-color:#fff}.section-1[data-v-43f85feb]{background:linear-gradient(180deg,#3aa1ff,#36d8d8);border-top-left-radius:%?20?%;border-top-right-radius:%?20?%}.section-2[data-v-43f85feb]{background:linear-gradient(180deg,#36d8d8,#45e48b)}.section-3[data-v-43f85feb]{background:linear-gradient(180deg,#45e48b,#95e362)}.section-4[data-v-43f85feb]{background:linear-gradient(180deg,#95e362,#ffb258)}.section-5[data-v-43f85feb]{background:linear-gradient(180deg,#ffb258,#ff6b6b);border-bottom-left-radius:%?20?%;border-bottom-right-radius:%?20?%}.value-indicator[data-v-43f85feb]{position:absolute;right:%?-120?%;text-align:center;width:%?120?%;padding:%?10?% %?20?%;border-radius:%?10?%;color:#fff;z-index:3}.value-indicator[data-v-43f85feb]::before{content:"";position:absolute;left:%?-20?%;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);border-width:%?10?%;border-style:solid;border-color:transparent var(--indicator-color) transparent transparent}\r\n\r\n/* 修改最大值指示器的样式 */.value-indicator.max-indicator[data-v-43f85feb]{background:#fff;z-index:2;color:currentColor;border:%?1?% solid}.value-indicator.max-indicator[data-v-43f85feb]::before{border-color:transparent currentColor transparent transparent}.operation-tips[data-v-43f85feb]{padding:%?30?%;opacity:1;background:#fff;border-radius:10px;background:linear-gradient(50deg,#e8f5ff -125%,#fff 142%);border:1px solid rgba(168,206,251,.5289);box-shadow:0 0 14px 0 rgba(79,79,79,.0641)}.tips-title[data-v-43f85feb]{font-size:%?32?%;margin-bottom:%?20?%}.tips-content[data-v-43f85feb]{color:#666;line-height:1.6}.button-group[data-v-43f85feb]{display:flex;justify-content:space-between;padding:0 %?30?%;gap:%?30?%}.btn[data-v-43f85feb]{flex:1;line-height:%?96?%;font-size:%?32?%;text-align:center;height:%?96?%;border-radius:%?10?%;color:#fff;display:flex;align-items:center;justify-content:center}.btn-retry[data-v-43f85feb]{background:#f5f5f5;color:#333}.btn-confirm[data-v-43f85feb]{background:linear-gradient(90deg,#59c2ff,#1b84ff);color:#fff}\r\n\r\n/* 结果弹框样式开始 */.result-modal[data-v-43f85feb]{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:20}.result-modal .modal-content[data-v-43f85feb]{position:relative;width:90%;padding-top:%?320?%;text-align:center;border-radius:0 0 %?20?% %?20?%}.result-modal .modal-bg[data-v-43f85feb]{position:absolute;top:%?-240?%;left:0;width:100%;z-index:1}.result-modal .content-wrapper[data-v-43f85feb]{position:relative;z-index:1;top:%?-90?%}.result-modal .score[data-v-43f85feb]{font-size:48px;font-weight:700;color:#fff}.result-modal .score-text[data-v-43f85feb]{font-size:16px;color:#fff;margin-bottom:30px}.result-modal .stats[data-v-43f85feb]{display:flex;justify-content:center;align-items:center;margin-bottom:30px}.result-modal .stat-item[data-v-43f85feb]{flex:1;text-align:center}.result-modal .divider[data-v-43f85feb]{width:1px;height:40px;background:#eee;margin:0 20px}.result-modal .stat-value[data-v-43f85feb]{font-size:24px;font-weight:700;color:#333}.result-modal .stat-label[data-v-43f85feb]{font-size:14px;color:#666;margin-top:5px}.result-modal .break-record[data-v-43f85feb]{font-size:%?40?%;color:#fff;margin-bottom:20px}\r\n\r\n/* 结果弹框样式结束 */',""]),t.exports=e},3216:function(t,e,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("9b8e")),o=n.default.observable({isBlueActive:!1,bluetoothDevices:{connected:null,deviceId:"",deviceType:"",serviceId:"",characteristicId:""},taskInfo:{taskId:null,exhale_duration:0}}),s={setBluetoothDevices:function(t){o.bluetoothDevices=t},setTaskInfo:function(t){o.taskInfo=t},setIsBlueActive:function(t){o.isBlueActive=t}},r={state:o,mutations:s};e.default=r},"3dbe":function(t,e,a){"use strict";var i=a("8983"),n=a.n(i);n.a},8983:function(t,e,a){var i=a("1c23");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("967d").default;n("4cf358a4",i,!0,{sourceMap:!1,shadowMode:!1})},"938e":function(t,e,a){"use strict";a.r(e);var i=a("d364"),n=a("efec");for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);a("3dbe");var s=a("828b"),r=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"43f85feb",null,!1,i["a"],void 0);e["default"]=r.exports},a04f:function(t,e,a){"use strict";a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.bleDataChange=function(t,e){var a=t.deviceId,o=t.serviceId,s=t.characteristicId;if(!(a&&a&&s))return n();uni.notifyBLECharacteristicValueChange({deviceId:a,serviceId:o,characteristicId:s,state:!0});uni.onBLECharacteristicValueChange((function(a){var n=function(t,e){var a=e.deviceType;return"JYK"==a?function(t){var e=i(t);if(20!==e.length)return{dataType:"init"==a,pressure:0,volume:0};var a=e.substring(0,2),n=e.substring(2,10),o=parseInt(n,16),s=e.substring(10,18),r=parseInt(s,16),l={dataType:81==a?"exhale":"inhale",pressure:o,volume:r};return console.log("解析结果:",l),l}(t):"FH"==a?function(t){var e=i(t);if(console.log("原始16进制数据:",e),20!==e.length)return{dataType:"init"==a,pressure:0,volume:0};var a=e.substring(0,2),n=e.substring(2,10),o=parseInt(n,16),s=e.substring(10,18),r=parseInt(s,16),l={dataType:81==a?"exhale":"inhale",pressure:o,volume:r};return console.log("解析结果:",l),l}(t):uni.showModal({title:"提示",content:"设备类型错误",showCancel:!1})}(a.value,t),o=n.dataType,s=n.pressure,r=n.volume;"exhale"!==o&&"inhale"!==o||e&&e(o,s,r)}))},e.bleDataStop=function(){uni.offBLECharacteristicValueChange(),uni.offBluetoothAdapterStateChange()},e.checkBluetooth=n,e.onBluetoothAdapterStateChange=function(){uni.onBluetoothAdapterStateChange((function(t){t.available||uni.showModal({title:"提示",content:"请打开蓝牙后重试",showCancel:!1})}))},a("fd3c"),a("4db2"),a("bf0f"),a("c976"),a("4d8f"),a("7b97"),a("668a"),a("c5b7"),a("8ff5"),a("2378"),a("641a"),a("64e0"),a("cce3"),a("efba"),a("d009"),a("bd7d"),a("7edd"),a("d798"),a("f547"),a("5e54"),a("b60a"),a("8c18"),a("12973"),a("f991"),a("198e"),a("8557"),a("63b1"),a("1954"),a("1cf1"),a("f7a5"),a("c9b5"),a("ab80"),a("e966");var i=function(t){var e=Array.prototype.map.call(new Uint8Array(t),(function(t){return("00"+t.toString(16)).slice(-2)}));return e.join("")};function n(){uni.openBluetoothAdapter().catch((function(t){var e=10001===t.errCode?"请打开蓝牙后重试":"初始化失败：".concat(t.errMsg);return uni.showModal({title:"提示",content:e,showCancel:!1}),Promise.reject(t)}))}},ceb9:function(t,e,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("3216")),o=a("a04f"),s={data:function(){return{touchTestTimer:null,value:0,indicatorValues:[7500,6e3,4500,3e3,1500,0],indicatorPosition:0,indicatorColor:"#FF6B6B",isBlowing:!1,showResult:!1,maxValue:0,lastMaxValue:0,ranking:0,maxValueIndicatorColor:"#FF6B6B",pressure:""}},onShow:function(){(0,o.bleDataChange)(n.default.state.bluetoothDevices,this.breathe)},onUnload:function(){this.blowTimeout&&clearTimeout(this.blowTimeout),(0,o.bleDataStop)()},methods:{backHandler:function(){uni.navigateBack({delta:1})},breathe:function(t,e,a){var i=this;this.isBlowing=!0,this.value=a,this.pressure=e,this.updateIndicatorPosition(),this.blowTimeout&&clearTimeout(this.blowTimeout),this.blowTimeout=setTimeout((function(){i.isBlowing=!1,i.emitHandler()}),200)},updateIndicatorPosition:function(){var t=this.value,e=this.indicatorValues,a=this.maxValue,i=e[0],n=t>i?100:t/i*100,o=a>i?100:a/i*100,s=this.getIndicatorColor(n),r=this.getIndicatorColor(o);this.indicatorPosition=n,this.indicatorColor=s,this.maxValueIndicatorColor=r},getIndicatorColor:function(t){return t>=90?"#3AA1FF":t>=70?"#36D8D8":t>=50?"#45E48B":t>=30?"#95E362":t>=10?"#FFB258":"#FF6B6B"},onRetry:function(){this.value=0,this.showResult=!1,this.updateIndicatorPosition()},goToTestList:function(){uni.navigateTo({url:"/pages/my/test_list"})},emitHandler:function(){uni.$emit("ble-test-result",{value:this.value,indicatorPosition:this.indicatorPosition})},onTouchStart:function(){},onTouchEnd:function(){}}};e.default=s},d364:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[a("v-uni-image",{staticClass:"bg-image",attrs:{src:"https://api.hqhis.com/admin-api/infra/file/4/get/2cc077cc9f51e02c3ca75c21adbef8cb1066279d62da74ae12a194ededb896e1.jpg",mode:"aspectFill"}}),a("v-uni-view",{staticClass:"body",on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.onTouchStart.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.onTouchEnd.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"main padding"},[t.isBlowing||0!=t.value?t._e():a("v-uni-view",{staticClass:"status-tip"},[a("v-uni-image",{staticClass:"status-icon",attrs:{src:"https://api.hqhis.com/admin-api/infra/file/4/get/a20fea24c590af4a9d35d2a47ed19a9bd92f0732b8d9a678b0a8444593ba2484.png"}}),a("v-uni-text",{staticClass:"status-title"},[t._v("肺活量测试")])],1),t.isBlowing&&t.value>0?a("v-uni-view",{staticClass:"status-tip"},[a("v-uni-image",{staticClass:"status-icon",attrs:{src:"https://api.hqhis.com/admin-api/infra/file/4/get/a20fea24c590af4a9d35d2a47ed19a9bd92f0732b8d9a678b0a8444593ba2484.png"}}),a("v-uni-text",{staticClass:"status-title"},[t._v("测试中")])],1):t._e(),!t.isBlowing&&t.value>0?a("v-uni-view",{staticClass:"status-tip"},[a("v-uni-image",{staticClass:"status-icon",attrs:{src:"https://api.hqhis.com/admin-api/infra/file/4/get/2d4a2c4fe185c7570f9cd1ba3cb236d4295f193deafeebee15182d2f3674ea89.png"}}),a("v-uni-text",{staticClass:"status-title"},[t._v("肺活量测试值 "+t._s(t.value))])],1):t._e(),a("v-uni-view",{staticClass:"scale-container"},[a("v-uni-view",{staticClass:"scale-numbers"},[t._l(t.indicatorValues,(function(e,i){return[a("v-uni-text",[t._v(t._s(e))])]}))],2),a("v-uni-view",{staticClass:"scale-bar"},[a("v-uni-view",{staticClass:"bar-gradient"},[a("v-uni-view",{staticClass:"gradient-section section-1"}),a("v-uni-view",{staticClass:"divider"}),a("v-uni-view",{staticClass:"gradient-section section-2"}),a("v-uni-view",{staticClass:"divider"}),a("v-uni-view",{staticClass:"gradient-section section-3"}),a("v-uni-view",{staticClass:"divider"}),a("v-uni-view",{staticClass:"gradient-section section-4"}),a("v-uni-view",{staticClass:"divider"}),a("v-uni-view",{staticClass:"gradient-section section-5"})],1),a("v-uni-view",{staticClass:"value-indicator",style:"bottom: "+(t.indicatorPosition-3)+"%; background: "+t.indicatorColor+"; --indicator-color: "+t.indicatorColor+";"},[a("v-uni-text",[t._v(t._s(t.value))])],1),t.maxValue>0?a("v-uni-view",{staticClass:"value-indicator max-indicator",style:"bottom: "+(t.maxValue/t.indicatorValues[0]*100-3)+"%; color: "+t.maxValueIndicatorColor+";",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goToTestList.apply(void 0,arguments)}}},[a("v-uni-text",[t._v(t._s(t.maxValue))])],1):t._e()],1)],1)],1),a("v-uni-view",{staticClass:"bottom margin"},[!t.isBlowing&&t.value>0&&!t.showResult?a("v-uni-view",{staticClass:"button-group"},[a("v-uni-button",{staticClass:"btn btn-retry",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onRetry.apply(void 0,arguments)}}},[t._v("再试一次")]),a("v-uni-button",{staticClass:"btn btn-confirm",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.backHandler.apply(void 0,arguments)}}},[t._v("返回")])],1):a("v-uni-view",{staticClass:"operation-tips"},[a("v-uni-view",{staticClass:"tips-title"},[t._v("操作提示")]),a("v-uni-view",{staticClass:"tips-content"},[t._v("请深吸一口气，对准测试仪吹气口全力呼出")])],1)],1)],1),t.showResult?a("v-uni-view",{staticClass:"result-modal"},[a("v-uni-view",{staticClass:"modal-content"},[a("v-uni-image",{staticClass:"modal-bg",attrs:{src:"https://api.hqhis.com/admin-api/infra/file/4/get/d0b2d7aa79919b814420c28b022bd044141bdc4f6e62fe1685e393469b908611.png",mode:"widthFix"}}),a("v-uni-view",{staticClass:"content-wrapper"},[a("v-uni-view",{staticClass:"break-record"},[t._v("恭喜你，破纪录啦！")]),a("v-uni-view",{staticClass:"score"},[t._v(t._s(t.maxValue))]),a("v-uni-view",{staticClass:"score-text"},[t._v("最高成绩")]),a("v-uni-view",{staticClass:"stats"},[a("v-uni-view",{staticClass:"stat-item"},[a("v-uni-view",{staticClass:"stat-value"},[t._v(t._s(t.lastMaxValue))]),a("v-uni-view",{staticClass:"stat-label"},[t._v("历史最高")])],1),a("v-uni-view",{staticClass:"divider"}),a("v-uni-view",{staticClass:"stat-item"},[a("v-uni-view",{staticClass:"stat-value"},[t._v(t._s(t.ranking)+"%")]),a("v-uni-view",{staticClass:"stat-label"},[t._v("超过全国")])],1)],1),a("v-uni-view",{staticClass:"button-group"},[a("v-uni-button",{staticClass:"btn btn-confirm",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onRetry.apply(void 0,arguments)}}},[t._v("再试一次")]),a("v-uni-button",{staticClass:"btn btn-retry",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goToHome.apply(void 0,arguments)}}},[t._v("进入主页")])],1)],1)],1)],1):t._e()],1)},n=[]},efec:function(t,e,a){"use strict";a.r(e);var i=a("ceb9"),n=a.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);e["default"]=n.a}}]);