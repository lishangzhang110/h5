(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pack_devices-pages-device-bpDevice"],{2313:function(e,n,t){var i=t("8735");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var c=t("967d").default;c("81c05cc4",i,!0,{sourceMap:!1,shadowMode:!1})},8735:function(e,n,t){var i=t("c86c");n=i(!1),n.push([e.i,'@charset "UTF-8";\r\n/**\r\n * uni-app内置的常用样式变量\r\n */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */uni-page-body[data-v-597ef101]{background-color:#f8f8f8}body.?%PAGE?%[data-v-597ef101]{background-color:#f8f8f8}.container[data-v-597ef101]{padding:%?30?%;align-items:left}.input[data-v-597ef101]{margin-top:3px;width:100%;border:1px solid #d3d3d3;border-radius:6px}.res[data-v-597ef101]{margin-top:3px;width:100%;border:3px solid #d3d3d3;border-radius:6px}.button[data-v-597ef101]{position:fixed;width:%?690?%;bottom:%?30?%}.icon[data-v-597ef101]{font-size:%?80?%;color:#94bcff}',""]),e.exports=n},9178:function(e,n,t){"use strict";t("6a54"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,t("bf0f"),t("2797"),t("80e3"),t("4db2"),t("c976"),t("4d8f"),t("7b97"),t("668a"),t("c5b7"),t("8ff5"),t("2378"),t("641a"),t("64e0"),t("cce3"),t("efba"),t("d009"),t("bd7d"),t("7edd"),t("d798"),t("f547"),t("5e54"),t("b60a"),t("8c18"),t("12973"),t("f991"),t("198e"),t("8557"),t("63b1"),t("1954"),t("1cf1"),t("c223");var i=getApp(),c={data:function(){return{inputText:"mootek",receiveText:"",name:"",connectedDeviceId:"",services:{},characteristics:{},connected:!0,searching:!1,serviceId:"",characteristicId:"",isMeasuring:!1,mt:"",sbp:120,dbp:80,hr:70,battery:3700}},components:{},props:{},onLoad:function(e){console.log(e);var n=this;n.name=e.name,n.connectedDeviceId=e.connectedDeviceId,uni.getBLEDeviceServices({deviceId:n.connectedDeviceId,success:function(t){n.services=t.services;for(var i=0;i<n.services.length;i++)if(t.services[i].isPrimary&&"0000FFF0"==t.services[i].uuid.split("-")[0]){n.serviceId=t.services[i].uuid;break}uni.getBLEDeviceCharacteristics({deviceId:e.connectedDeviceId,serviceId:n.serviceId,success:function(e){console.log(222,e.characteristics),n.characteristics=e.characteristics,e.characteristics.forEach((function(e){e.properties.write&&(console.log(e.uuid),n.characteristicId=e.uuid),(e.properties.notify||e.properties.indicate)&&(console.log("notify "+e.uuid),uni.notifyBLECharacteristicValueChange({deviceId:n.connectedDeviceId,serviceId:n.serviceId,characteristicId:e.uuid,state:!0,success:function(e){console.log("notify成功"),console.log(e)},fail:function(e){console.log("notify失败"),console.log(e)}}))}))}})}}),n.onBLECharacteristicValueChange(),uni.onBLEConnectionStateChange((function(e){console.log(e.connected),n.connected=e.connected}))},onReady:function(){},onShow:function(){},onHide:function(){},methods:{calcEOR:function(e){for(var n=0,t=e.length,i=2;i<e.length-2;i++)n^=e[i];e[t-1]=n},sendMsg:function(e){var n=[204,128,2,3,1,0,0,0];n[5]=e,this.calcEOR(n),console.log(n),this.sendToBlueDevice(n)},sendToBlueDevice:function(e){var n=this;if(n.connected){var t=new ArrayBuffer(e.length),i=new Uint8Array(t);console.log(t,i);for(var c=0;c<e.length;c++)i[c]=e[c];uni.writeBLECharacteristicValue({deviceId:n.connectedDeviceId,serviceId:n.serviceId,characteristicId:n.characteristicId,value:t,success:function(e){console.log("发送指令成功:"+e.errMsg)},fail:function(e){console.log("message发送失败:"+e.errMsg),uni.showToast({title:"数据发送失败，请稍后重试",icon:"none"})}})}else uni.showModal({title:"提示",content:"蓝牙已断开",showCancel:!1,success:function(e){n.searching=!1}})},bindInput:function(e){this.inputText=e.detail.value,console.log(e.detail.value)},Send:function(){var e=this;if(e.connected){var n=new ArrayBuffer(e.inputText.length),t=new Uint8Array(n);console.log(n,t);for(var i=0;i<e.inputText.length;i++)t[i]=e.inputText.charCodeAt(i);uni.writeBLECharacteristicValue({deviceId:e.connectedDeviceId,serviceId:e.serviceId,characteristicId:e.characteristicId,value:n,success:function(e){console.log("发送指令成功:"+e.errMsg)},fail:function(e){console.log("message发送失败:"+e.errMsg),uni.showToast({title:"数据发送失败，请稍后重试",icon:"none"})}})}else uni.showModal({title:"提示",content:"蓝牙已断开",showCancel:!1,success:function(n){e.searching=!1}})},onBLECharacteristicValueChange:function(){console.log("onBLECharacteristicValueChange");var e=this;console.log(uni.onBLECharacteristicValueChange),uni.onBLECharacteristicValueChange((function(n){var t=new Uint8Array(n.value);e.receiveText=i.globalData.arrayBufferToHex(n.value),console.log("监听低功耗蓝牙设备的特征值变化事件成功",e.receiveText);var c=t[5];switch(c){case 1:console.log("类型是 1 连接指令");break;case 2:console.log("类型是 2 启动指令"),e.isMeasuring=!0;break;case 3:console.log("类型是 3 停止测量指令"),e.isMeasuring=!1;break;case 4:console.log("类型是 4 查询电量");break;case 5:console.log("类型是 5 血压计向终端发送实时压力（测量过程中发送）");var a=t[7],o=t[10];e.dbp=256*a+o^a;break;case 6:console.log("类型是 6 血压计向终端发送测量结果（测量完成后）"),e.isMeasuring=!1;var s=t[7]+2e3,r=t[8],u=t[9],l=t[10],d=t[11],v=t[12];e.mt="".concat(s).concat(r).concat(u," ").concat(l,":").concat(d,":").concat(v),e.sbp=(t[13]<<8)+t[14],e.dbp=(t[15]<<8)+t[16],e.hr=(t[17]<<8)+t[18];break;case 7:console.log("类型是 7 错误代码");break;default:console.log("未知类型");break}}))}}};n.default=c},a715:function(e,n,t){"use strict";t.r(n);var i=t("a9de"),c=t("afab");for(var a in c)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return c[e]}))}(a);t("a876");var o=t("828b"),s=Object(o["a"])(c["default"],i["b"],i["c"],!1,null,"597ef101",null,!1,i["a"],void 0);n["default"]=s.exports},a876:function(e,n,t){"use strict";var i=t("2313"),c=t.n(i);c.a},a9de:function(e,n,t){"use strict";t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return c})),t.d(n,"a",(function(){}));var i=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("v-uni-view",{staticClass:"container"},[t("v-uni-view",{staticClass:"device-info"},[t("v-uni-text",{staticStyle:{"font-size":"medium","word-break":"break-all"}},[e._v("设备名称："+e._s(e.name))]),t("v-uni-text",{staticStyle:{"font-size":"x-small",color:"gray","word-break":"break-all"}},[e._v("设备ID："+e._s(e.connectedDeviceId))]),t("v-uni-text",{staticStyle:{"font-size":"x-small",color:"gray"}},[e._v("状态："+e._s(e.connected?"已连接":"已断开"))])],1),e.isMeasuring?t("v-uni-button",{attrs:{type:"primary"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.sendMsg(3)}}},[e._v("停止测量")]):t("v-uni-button",{attrs:{type:"primary"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.sendMsg(2)}}},[e._v("开始测量")]),t("v-uni-view",{staticClass:"measurement"},[t("v-uni-view",{staticClass:"iconfont2 icon--yiliao-xieya icon"}),t("v-uni-view",{staticClass:"text-result"},[e._v(e._s(e.sbp)+"/"+e._s(e.dbp)+" "+e._s(e.mt))])],1),t("v-uni-view",{staticClass:"measurement"},[t("v-uni-view",{staticClass:"iconfont2 icon-xintiao icon"}),t("v-uni-view",{staticClass:"text-result"},[e._v(e._s(e.hr))])],1),t("v-uni-button",{attrs:{type:"primary"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.sendMsg(4)}}},[e._v("读取电量")]),t("v-uni-view",{staticClass:"measurement"},[t("v-uni-view",{staticClass:"iconfont2 icon--yiliao-xieya icon"}),t("v-uni-view",{staticClass:"text-result"},[e._v(e._s(e.battery))])],1),t("v-uni-text",{staticStyle:{"font-size":"medium","margin-top":"10px"}},[e._v("数据内容：")]),t("v-uni-textarea",{staticClass:"res",attrs:{maxlength:"-1",disabled:!0,value:e.receiveText}})],1)},c=[]},afab:function(e,n,t){"use strict";t.r(n);var i=t("9178"),c=t.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(a);n["default"]=c.a}}]);